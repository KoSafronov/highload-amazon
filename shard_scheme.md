─────────────────────────────────────────────────────────────────────────────
                        СХЕМА ШАРДИРОВАНИЯ
─────────────────────────────────────────────────────────────────────────────

                           ┌─────────────────────────────┐
                           │        USERS DB             │
                           │  PostgreSQL (master + 2xrep)│
                           └─────────────────────────────┘
                                      ▲
                    ┌─────────────────┼────────────────┐
                    ▼                 ▼                ▼
               SELLERS           ADDRESSES        PAYMENT_METHODS
          PostgreSQL shard0     PostgreSQL        PostgreSQL


─────────────────────────────────────────────────────────────────────────────

                         ШАРДИРУЕМЫЕ ДАННЫЕ ПО КЛЮЧАМ
─────────────────────────────────────────────────────────────────────────────

                         [ SHARD GROUP: ORDERS ]
             ┌────────────────────────────┐
             │      ORDER SHARDING        │
             └────────────────────────────┘
                       Shard Key: `user_id`
                       Strategy: Consistent Hashing
                       Storage: PostgreSQL/YugabyteDB

                  ┌────────────┬────────────┬────────────┐
                  │ Shard-1    │ Shard-2    │ Shard-3    │
                  └────────────┴────────────┴────────────┘
                  │ Orders     │ Orders     │ Orders     │
                  │ OrderItems │ OrderItems │ OrderItems │
                  └────────────┴────────────┴────────────┘
                       ▲             ▲             ▲
                       │             │             │
                    2x Replicas   2x Replicas   2x Replicas

─────────────────────────────────────────────────────────────────────────────

                        [ SHARD GROUP: SHIPMENTS ]
             ┌────────────────────────────┐
             │     SHIPMENT SHARDING      │
             └────────────────────────────┘
                     Shard Key: `order_id`
                     Strategy: Hash Partitioning
                     Storage: Cassandra or ScyllaDB

                  ┌────────────┬────────────┬────────────┐
                  │ Shard-X    │ Shard-Y    │ Shard-Z    │
                  └────────────┴────────────┴────────────┘
                  │ Shipments  │ Shipments  │ Shipments  │
                  └────────────┴────────────┴────────────┘
                       ▲             ▲             ▲
                   3x Replica     3x Replica     3x Replica

─────────────────────────────────────────────────────────────────────────────

                  [ SEARCH INDEX — АВТО ШАРДИРОВАНИЕ ]
           ┌──────────────────────────────────────────────┐
           │         Elasticsearch/OpenSearch             │
           │    Auto-sharding: 5 primary shards + replicas│
           │     Shard Key: internal hash by product_id   │
           └──────────────────────────────────────────────┘

─────────────────────────────────────────────────────────────────────────────

                       Остальные таблицы без шардирования
─────────────────────────────────────────────────────────────────────────────




